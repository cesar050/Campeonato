<!-- TOAST -->
<app-toast
  [show]="showToast()"
  [type]="toastType()"
  [title]="toastTitle()"
  [message]="toastMessage()"
  (close)="cerrarToast()">
</app-toast>

<!-- CONTAINER PRINCIPAL -->
<div class="min-h-screen bg-gray-50 dark:bg-[#102211]">
  
  <!-- HEADER -->
  <div class="bg-white dark:bg-[#182c19] border-b-2 border-gray-200 dark:border-[#2a452b] sticky top-0 z-40 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4">
        <div>
          <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
            <span class="material-symbols-outlined text-[#2E7D32]">event</span>
            Calendario de Partidos
          </h1>
          <p class="text-gray-600 dark:text-gray-400 mt-1">
            Gestiona y monitorea todos los partidos • {{ stats().partidosTotales }} partidos • {{ stats().partidosJugados }} finalizados
          </p>
        </div>

        <button 
          (click)="generarFixtureAutomatico()"
          class="px-6 py-3 rounded-xl bg-[#2E7D32] text-white font-bold hover:bg-[#1B5E20] transition-all flex items-center gap-2 shadow-lg">
          <span class="material-symbols-outlined">calendar_add_on</span>
          Generar Fixture
        </button>
      </div>

      <!-- Filtro de Campeonato -->
      <div class="flex items-center gap-4 mb-4">
        <label class="text-sm font-semibold text-gray-700 dark:text-gray-300">
          Campeonato:
        </label>
        <select 
          [(ngModel)]="campeonatoSeleccionado"
          (change)="cambiarCampeonato()"
          class="flex-1 max-w-md px-4 py-2 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-4 focus:ring-[#2E7D32]/20 focus:border-[#2E7D32] transition-all">
          <option [value]="null" disabled>Selecciona un campeonato</option>
          <option *ngFor="let campeonato of misCampeonatos()" [value]="campeonato.id_campeonato">
            {{ campeonato.nombre }}
          </option>
        </select>
      </div>

      <!-- Tabs de vistas -->
      <div class="flex gap-2">
        <button 
          (click)="cambiarVista('lista')"
          [class]="'flex-1 px-6 py-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2 ' + 
                   (vistaActual() === 'lista' 
                     ? 'bg-[#2E7D32] text-white shadow-lg' 
                     : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600')">
          <span class="material-symbols-outlined">list</span>
          Fixture por Jornadas
        </button>
        <button 
          (click)="cambiarVista('tabla')"
          [class]="'flex-1 px-6 py-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2 ' + 
                   (vistaActual() === 'tabla' 
                     ? 'bg-[#2E7D32] text-white shadow-lg' 
                     : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600')">
          <span class="material-symbols-outlined">table_chart</span>
          Tabla de Posiciones
        </button>
      </div>
    </div>
  </div>

  <!-- LOADING -->
  <div *ngIf="loading()" class="flex items-center justify-center py-20">
    <div class="text-center">
      <div class="inline-block w-16 h-16 border-4 border-gray-200 border-t-[#2E7D32] rounded-full animate-spin mb-4"></div>
      <p class="text-gray-600 dark:text-gray-400 font-medium">Cargando partidos...</p>
    </div>
  </div>

  <!-- CONTENIDO -->
  <div *ngIf="!loading()" class="max-w-7xl mx-auto px-4 sm:px-6 py-6 sm:py-8">

    <!-- ========================================== -->
    <!-- VISTA: FIXTURE POR JORNADAS -->
    <!-- ========================================== -->
    <div *ngIf="vistaActual() === 'lista'">
      
      <!-- Empty state -->
      <div *ngIf="partidos().length === 0" 
           class="bg-white dark:bg-[#182c19] rounded-2xl border-2 border-gray-200 dark:border-[#2a452b] shadow-sm p-12">
        <div class="text-center">
          <div class="w-24 h-24 mx-auto rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-6">
            <span class="material-symbols-outlined text-6xl text-gray-400">sports_soccer</span>
          </div>
          <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
            No hay partidos programados
          </h3>
          <p class="text-gray-600 dark:text-gray-400 mb-6">
            Genera el fixture automáticamente para crear los partidos
          </p>
          <button 
            (click)="generarFixtureAutomatico()"
            class="px-8 py-4 rounded-xl bg-[#2E7D32] text-white font-bold hover:bg-[#1B5E20] transition-all flex items-center gap-2 mx-auto shadow-lg">
            <span class="material-symbols-outlined">calendar_add_on</span>
            Generar Fixture
          </button>
        </div>
      </div>

      <!-- Fixture con paginación por jornadas -->
      <div *ngIf="partidos().length > 0 && jornadaActual() !== null">
        
        <!-- Header con navegación de jornadas -->
        <div class="bg-white dark:bg-gray-800 rounded-xl border-2 border-gray-200 dark:border-gray-700 p-4 sm:p-6 mb-6">
          <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
            
            <!-- Título y estadísticas -->
            <div class="flex-1">
              <h3 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-2">
                Fixture del Campeonato
              </h3>
              <p class="text-gray-600 dark:text-gray-400 text-sm">
                {{ partidos().length }} partidos totales • {{ stats().partidosJugados }} finalizados • {{ stats().golesTotales }} goles
              </p>
            </div>

            <!-- Selector de jornada y navegación -->
            <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
              <div class="relative flex-1 sm:flex-initial sm:min-w-[200px]">
                <select 
                  [value]="jornadaActual()!"
                  (change)="seleccionarJornada(+$any($event.target).value)"
                  class="w-full px-4 py-2.5 rounded-lg border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-semibold appearance-none cursor-pointer hover:border-[#2E7D32] focus:outline-none focus:border-[#2E7D32] pr-10">
                  <option *ngFor="let jornada of getJornadasDisponibles()" [value]="jornada">
                    Jornada {{ jornada }}
                  </option>
                </select>
                <span class="absolute right-3 top-1/2 -translate-y-1/2 material-symbols-outlined text-gray-500 pointer-events-none">
                  expand_more
                </span>
              </div>

              <div class="flex items-center gap-2">
                <button 
                  (click)="irAJornadaAnterior()"
                  [disabled]="getJornadasDisponibles().indexOf(jornadaActual()!) === 0"
                  [class]="getJornadasDisponibles().indexOf(jornadaActual()!) === 0
                    ? 'px-4 py-2.5 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-gray-400 cursor-not-allowed'
                    : 'px-4 py-2.5 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-[#2E7D32] hover:bg-[#2E7D32] hover:text-white transition-colors'">
                  <span class="material-symbols-outlined">chevron_left</span>
                </button>
                <button 
                  (click)="irAJornadaSiguiente()"
                  [disabled]="getJornadasDisponibles().indexOf(jornadaActual()!) === getJornadasDisponibles().length - 1"
                  [class]="getJornadasDisponibles().indexOf(jornadaActual()!) === getJornadasDisponibles().length - 1
                    ? 'px-4 py-2.5 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-gray-400 cursor-not-allowed'
                    : 'px-4 py-2.5 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-[#2E7D32] hover:bg-[#2E7D32] hover:text-white transition-colors'">
                  <span class="material-symbols-outlined">chevron_right</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Estadísticas de jornada actual -->
          <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
            <div class="flex flex-wrap items-center gap-4 text-sm">
              <div class="flex items-center gap-2">
                <span class="material-symbols-outlined text-[#2E7D32] text-lg">sports_soccer</span>
                <span class="text-gray-600 dark:text-gray-400">Jornada {{ jornadaActual() }}:</span>
                <span class="font-bold text-gray-900 dark:text-white">{{ getStatsJornadaActual().total }} partidos</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="material-symbols-outlined text-blue-500 text-lg">schedule</span>
                <span class="text-gray-600 dark:text-gray-400">{{ getStatsJornadaActual().programados }} por jugar</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="material-symbols-outlined text-green-500 text-lg">check_circle</span>
                <span class="text-gray-600 dark:text-gray-400">{{ getStatsJornadaActual().finalizados }} finalizados</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Filtro rápido por estado -->
        <div class="flex items-center gap-2 mb-6">
          <button 
            (click)="filtroEstado.set('todos')"
            [class]="filtroEstado() === 'todos' 
              ? 'px-4 py-2 rounded-lg bg-[#2E7D32] text-white font-semibold' 
              : 'px-4 py-2 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-[#2E7D32]'">
            Todos
          </button>
          <button 
            (click)="filtroEstado.set('programado')"
            [class]="filtroEstado() === 'programado' 
              ? 'px-4 py-2 rounded-lg bg-blue-600 text-white font-semibold' 
              : 'px-4 py-2 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-blue-600'">
            Por jugar
          </button>
          <button 
            (click)="filtroEstado.set('finalizado')"
            [class]="filtroEstado() === 'finalizado' 
              ? 'px-4 py-2 rounded-lg bg-green-600 text-white font-semibold' 
              : 'px-4 py-2 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-green-600'">
            Finalizados
          </button>
        </div>

        <!-- Lista de partidos agrupados por fecha -->
        <div *ngIf="getPartidosJornadaActual().length > 0" class="space-y-6">
          <div *ngFor="let fecha of getFechasJornadaActual()" class="space-y-3">
            
            <!-- Encabezado de fecha -->
            <div class="flex items-center gap-3 mb-4">
              <div class="flex-1 h-px bg-gray-200 dark:bg-gray-700"></div>
              <h4 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2 px-4">
                <span class="material-symbols-outlined text-[#2E7D32]">event</span>
                {{ formatearFecha(fecha) }}
              </h4>
              <div class="flex-1 h-px bg-gray-200 dark:bg-gray-700"></div>
            </div>

            <!-- Tarjetas de partidos -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
              <div 
                *ngFor="let partido of getPartidosPorFechaEnJornada(fecha)"
                (click)="verDetallePartido(partido.id_partido)"
                class="partido-card group relative bg-white dark:bg-gray-800 rounded-xl border-2 border-gray-200 dark:border-gray-700 hover:border-[#2E7D32] hover:shadow-lg transition-all cursor-pointer overflow-hidden">
                
                <!-- Estado badge -->
                <div class="absolute top-3 right-3 z-10">
                  <span [class]="getEstadoPartidoClasses(partido.estado)">
                    {{ getEstadoPartidoLabel(partido.estado) }}
                  </span>
                </div>

                <!-- Contenido del partido -->
                <div class="p-6">
                  
                  <!-- Hora -->
                  <div class="flex items-center gap-3 mb-4">
                    <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400">
                      <span class="material-symbols-outlined text-lg">schedule</span>
                      <span class="font-semibold">{{ formatearHora(partido.fecha_partido) }}</span>
                    </div>
                  </div>

                  <!-- Equipos VS -->
                  <div class="flex items-center justify-between gap-4">
                    
                    <!-- Equipo Local -->
                    <div class="flex-1 flex flex-col items-center text-center">
                      <div class="w-16 h-16 rounded-full overflow-hidden border-2 border-gray-200 dark:border-gray-700 flex-shrink-0 mb-2">
                        <app-image-placeholder
                          [src]="obtenerLogoEquipo(partido.id_equipo_local)"
                          [type]="'team'"
                          [size]="'lg'"
                          [alt]="'Logo de ' + obtenerNombreEquipo(partido.id_equipo_local)">
                        </app-image-placeholder>
                      </div>
                      <p class="font-bold text-gray-900 dark:text-white line-clamp-2">
                        {{ obtenerNombreEquipo(partido.id_equipo_local) }}
                      </p>
                      
                      <!-- Marcador -->
                      <div *ngIf="partido.estado === 'finalizado'" 
                           class="mt-2 w-12 h-12 rounded-lg bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
                        <span class="text-2xl font-bold text-gray-900 dark:text-white">
                          {{ partido.goles_local || 0 }}
                        </span>
                      </div>
                    </div>

                    <!-- VS -->
                    <div class="flex flex-col items-center gap-2">
                      <div class="w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
                        <span class="text-sm font-bold text-gray-600 dark:text-gray-400">VS</span>
                      </div>
                    </div>

                    <!-- Equipo Visitante -->
                    <div class="flex-1 flex flex-col items-center text-center">
                      <div class="w-16 h-16 rounded-full overflow-hidden border-2 border-gray-200 dark:border-gray-700 flex-shrink-0 mb-2">
                        <app-image-placeholder
                          [src]="obtenerLogoEquipo(partido.id_equipo_visitante)"
                          [type]="'team'"
                          [size]="'lg'"
                          [alt]="'Logo de ' + obtenerNombreEquipo(partido.id_equipo_visitante)">
                        </app-image-placeholder>
                      </div>
                      <p class="font-bold text-gray-900 dark:text-white line-clamp-2">
                        {{ obtenerNombreEquipo(partido.id_equipo_visitante) }}
                      </p>
                      
                      <!-- Marcador -->
                      <div *ngIf="partido.estado === 'finalizado'" 
                           class="mt-2 w-12 h-12 rounded-lg bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
                        <span class="text-2xl font-bold text-gray-900 dark:text-white">
                          {{ partido.goles_visitante || 0 }}
                        </span>
                      </div>
                    </div>
                  </div>

                  <!-- Información adicional -->
                  <div class="mt-4 pt-4 border-t-2 border-gray-100 dark:border-gray-700 flex items-center justify-between text-sm">
                    <div *ngIf="partido.lugar" class="flex items-center gap-2 text-gray-600 dark:text-gray-400">
                      <span class="material-symbols-outlined text-lg">stadium</span>
                      <span class="truncate">{{ partido.lugar }}</span>
                    </div>
                    
                    <div class="flex items-center gap-2">
                      <button 
                        *ngIf="partido.estado === 'programado'"
                        (click)="editarPartido(partido, $event)"
                        class="px-3 py-1.5 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:border-blue-500 hover:text-blue-600 flex items-center gap-1 transition-all"
                        title="Editar fecha/hora">
                        <span class="material-symbols-outlined text-sm">edit</span>
                        <span class="text-xs font-semibold">Editar</span>
                      </button>
                      
                      <button class="text-[#2E7D32] font-semibold hover:underline flex items-center gap-1">
                        Ver detalles
                        <span class="material-symbols-outlined text-lg group-hover:translate-x-1 transition-transform">arrow_forward</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Mensaje cuando no hay partidos -->
        <div *ngIf="getPartidosJornadaActual().length === 0" 
             class="text-center py-12 bg-white dark:bg-gray-800 rounded-xl border-2 border-gray-200 dark:border-gray-700">
          <span class="material-symbols-outlined text-6xl text-gray-400 mb-4">sports_soccer</span>
          <p class="text-lg font-semibold text-gray-600 dark:text-gray-400">
            No hay partidos en esta jornada con el filtro seleccionado
          </p>
        </div>
      </div>
    </div>

    <!-- ========================================== -->
    <!-- VISTA: TABLA DE POSICIONES -->
    <!-- ========================================== -->
    <div *ngIf="vistaActual() === 'tabla'">
      
      <!-- LOADING -->
      <div *ngIf="loadingTabla()" class="flex items-center justify-center py-20">
        <div class="text-center">
          <div class="inline-block w-16 h-16 border-4 border-gray-200 border-t-[#2E7D32] rounded-full animate-spin mb-4"></div>
          <p class="text-gray-600 dark:text-gray-400 font-medium">Calculando posiciones...</p>
        </div>
      </div>

      <!-- TABLA -->
      <div *ngIf="!loadingTabla() && tablaPosiciones().length > 0" 
           class="bg-white dark:bg-[#182c19] rounded-2xl border-2 border-gray-200 dark:border-[#2a452b] shadow-lg overflow-hidden">
        
        <!-- Header -->
        <div class="bg-gradient-to-r from-[#2E7D32] to-[#1B5E20] text-white px-6 py-4">
          <h3 class="text-2xl font-bold flex items-center gap-3">
            <span class="material-symbols-outlined text-3xl">emoji_events</span>
            Tabla de Posiciones
          </h3>
          <p class="text-sm text-green-100 mt-1">
            Victoria = 3pts | Empate = 1pt | Derrota = 0pts
          </p>
        </div>

        <!-- Tabla Desktop -->
        <div class="hidden lg:block overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gray-100 dark:bg-gray-800 border-b-2 border-gray-200 dark:border-gray-700">
              <tr>
                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase">Pos</th>
                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase">Equipo</th>
                <th class="px-6 py-4 text-center text-xs font-bold text-gray-700 dark:text-gray-300 uppercase">PJ</th>
                <th class="px-6 py-4 text-center text-xs font-bold text-gray-700 dark:text-gray-300 uppercase">G</th>
                <th class="px-6 py-4 text-center text-xs font-bold text-gray-700 dark:text-gray-300 uppercase">E</th>
                <th class="px-6 py-4 text-center text-xs font-bold text-gray-700 dark:text-gray-300 uppercase">P</th>
                <th class="px-6 py-4 text-center text-xs font-bold text-gray-700 dark:text-gray-300 uppercase">GF</th>
                <th class="px-6 py-4 text-center text-xs font-bold text-gray-700 dark:text-gray-300 uppercase">GC</th>
                <th class="px-6 py-4 text-center text-xs font-bold text-gray-700 dark:text-gray-300 uppercase">DIF</th>
                <th class="px-6 py-4 text-center text-xs font-bold text-gray-700 dark:text-gray-300 uppercase">PTS</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
              <tr *ngFor="let equipo of tablaPosiciones(); let i = index"
                  [class]="'hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors ' + 
                           (i === 0 ? 'bg-yellow-50 dark:bg-yellow-900/20' : 
                            i < 4 ? 'bg-green-50 dark:bg-green-900/20' : 
                            i >= tablaPosiciones().length - 3 ? 'bg-red-50 dark:bg-red-900/20' : '')">
                
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center gap-3">
                    <div [class]="'w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold ' +
                                  (i === 0 ? 'bg-yellow-400 text-yellow-900' : 
                                   i < 4 ? 'bg-green-500 text-white' : 
                                   i >= tablaPosiciones().length - 3 ? 'bg-red-500 text-white' : 
                                   'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300')">
                      {{ equipo.posicion }}
                    </div>
                    <span *ngIf="i === 0" class="material-symbols-outlined text-yellow-500 text-2xl">emoji_events</span>
                  </div>
                </td>

                <td class="px-6 py-4">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-[#2E7D32] to-[#1B5E20] flex items-center justify-center">
                      <span class="material-symbols-outlined text-white text-xl">shield</span>
                    </div>
                    <p class="text-sm font-bold text-gray-900 dark:text-white">{{ equipo.nombre }}</p>
                  </div>
                </td>

                <td class="px-6 py-4 text-center text-sm font-semibold text-gray-900 dark:text-white">{{ equipo.partidos_jugados }}</td>
                <td class="px-6 py-4 text-center text-sm font-semibold text-green-600 dark:text-green-400">{{ equipo.ganados }}</td>
                <td class="px-6 py-4 text-center text-sm font-semibold text-gray-600 dark:text-gray-400">{{ equipo.empatados }}</td>
                <td class="px-6 py-4 text-center text-sm font-semibold text-red-600 dark:text-red-400">{{ equipo.perdidos }}</td>
                <td class="px-6 py-4 text-center text-sm font-semibold text-gray-900 dark:text-white">{{ equipo.goles_favor }}</td>
                <td class="px-6 py-4 text-center text-sm font-semibold text-gray-900 dark:text-white">{{ equipo.goles_contra }}</td>
                <td class="px-6 py-4 text-center">
                  <span [class]="'text-sm font-bold px-3 py-1 rounded-full ' + 
                                (equipo.diferencia_goles > 0 ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' : 
                                 equipo.diferencia_goles < 0 ? 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400' : 
                                 'bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400')">
                    {{ equipo.diferencia_goles > 0 ? '+' : '' }}{{ equipo.diferencia_goles }}
                  </span>
                </td>
                <td class="px-6 py-4 text-center">
                  <span class="inline-flex items-center justify-center w-12 h-12 rounded-xl bg-[#2E7D32] text-white text-lg font-bold shadow-md">
                    {{ equipo.puntos }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Tabla Mobile -->
        <div class="lg:hidden divide-y divide-gray-200 dark:divide-gray-700">
          <div *ngFor="let equipo of tablaPosiciones(); let i = index"
               [class]="'p-4 ' + 
                        (i === 0 ? 'bg-yellow-50 dark:bg-yellow-900/20' : 
                         i < 4 ? 'bg-green-50 dark:bg-green-900/20' : 
                         i >= tablaPosiciones().length - 3 ? 'bg-red-50 dark:bg-red-900/20' : '')">
            
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center gap-3">
                <div [class]="'w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold ' +
                              (i === 0 ? 'bg-yellow-400 text-yellow-900' : 
                               i < 4 ? 'bg-green-500 text-white' : 
                               i >= tablaPosiciones().length - 3 ? 'bg-red-500 text-white' : 
                               'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300')">
                  {{ equipo.posicion }}
                </div>
                <div class="w-8 h-8 rounded-full bg-gradient-to-br from-[#2E7D32] to-[#1B5E20] flex items-center justify-center">
                  <span class="material-symbols-outlined text-white text-sm">shield</span>
                </div>
                <p class="text-sm font-bold text-gray-900 dark:text-white">{{ equipo.nombre }}</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-[#2E7D32] text-white flex items-center justify-center text-lg font-bold shadow-md">
                {{ equipo.puntos }}
              </div>
            </div>

            <div class="grid grid-cols-3 gap-2 text-center">
              <div class="bg-white dark:bg-gray-800 rounded-lg p-2">
                <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">PJ</p>
                <p class="text-sm font-bold text-gray-900 dark:text-white">{{ equipo.partidos_jugados }}</p>
              </div>
              <div class="bg-white dark:bg-gray-800 rounded-lg p-2">
                <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">G-E-P</p>
                <p class="text-sm font-bold text-gray-900 dark:text-white">
                  {{ equipo.ganados }}-{{ equipo.empatados }}-{{ equipo.perdidos }}
                </p>
              </div>
              <div class="bg-white dark:bg-gray-800 rounded-lg p-2">
                <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">DIF</p>
                <p [class]="'text-sm font-bold ' + 
                           (equipo.diferencia_goles > 0 ? 'text-green-600' : 
                            equipo.diferencia_goles < 0 ? 'text-red-600' : 'text-gray-600')">
                  {{ equipo.diferencia_goles > 0 ? '+' : '' }}{{ equipo.diferencia_goles }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Leyenda -->
        <div class="bg-gray-50 dark:bg-gray-800 px-6 py-4 border-t-2 border-gray-200 dark:border-gray-700">
          <div class="flex flex-wrap gap-4 text-xs mb-2">
            <div class="flex items-center gap-2">
              <div class="w-4 h-4 rounded bg-yellow-400"></div>
              <span class="text-gray-700 dark:text-gray-300">Campeón</span>
            </div>
            <div class="flex items-center gap-2">
              <div class="w-4 h-4 rounded bg-green-500"></div>
              <span class="text-gray-700 dark:text-gray-300">Clasificación</span>
            </div>
            <div class="flex items-center gap-2">
              <div class="w-4 h-4 rounded bg-red-500"></div>
              <span class="text-gray-700 dark:text-gray-300">Descenso</span>
            </div>
          </div>
          <p class="text-xs text-gray-500 dark:text-gray-400">
            PJ: Partidos | G: Ganados | E: Empates | P: Perdidos | GF: Goles Favor | GC: Goles Contra | DIF: Diferencia | PTS: Puntos
          </p>
        </div>
      </div>

      <!-- EMPTY STATE -->
      <div *ngIf="!loadingTabla() && tablaPosiciones().length === 0" 
           class="text-center py-20 bg-white dark:bg-[#182c19] rounded-2xl border-2 border-gray-200 dark:border-[#2a452b]">
        <div class="w-24 h-24 mx-auto mb-6 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center">
          <span class="material-symbols-outlined text-6xl text-gray-400">emoji_events</span>
        </div>
        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">No hay datos para la tabla</h3>
        <p class="text-gray-600 dark:text-gray-400">Completa algunos partidos para ver las posiciones</p>
      </div>
    </div>
  </div>
</div>

<!-- ========================================== -->
<!-- MODAL: EDITAR PARTIDO -->
<!-- ========================================== -->
<div *ngIf="showEditarModal() && partidoEditando()" 
     class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"
     (click)="cerrarEditarModal()">
  <div class="bg-white dark:bg-[#182c19] rounded-2xl border-2 border-gray-200 dark:border-[#2a452b] max-w-2xl w-full shadow-2xl"
       (click)="$event.stopPropagation()">
    
    <!-- Header -->
    <div class="bg-gradient-to-r from-[#2E7D32] to-[#1B5E20] text-white px-6 py-4 flex items-center justify-between rounded-t-2xl">
      <h3 class="text-xl font-bold flex items-center gap-2">
        <span class="material-symbols-outlined">edit_calendar</span>
        Reprogramar Partido
      </h3>
      <button 
        (click)="cerrarEditarModal()"
        [disabled]="guardando()"
        class="w-10 h-10 rounded-lg hover:bg-white/20 flex items-center justify-center transition-all">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>

    <!-- Contenido -->
    <div class="p-6">
      
      <!-- Info del partido -->
      <div class="mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-xl border-2 border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between">
          <div class="flex-1 text-right pr-4">
            <p class="font-bold text-gray-900 dark:text-white text-lg">
              {{ obtenerNombreEquipo(partidoEditando()!.id_equipo_local) }}
            </p>
            <p class="text-xs text-gray-500 dark:text-gray-400">Local</p>
          </div>
          <div class="px-4">
            <span class="text-2xl font-bold text-gray-400">VS</span>
          </div>
          <div class="flex-1 pl-4">
            <p class="font-bold text-gray-900 dark:text-white text-lg">
              {{ obtenerNombreEquipo(partidoEditando()!.id_equipo_visitante) }}
            </p>
            <p class="text-xs text-gray-500 dark:text-gray-400">Visitante</p>
          </div>
        </div>
        <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 text-center">
          <p class="text-sm text-gray-600 dark:text-gray-400">
            Jornada {{ partidoEditando()!.jornada }}
          </p>
        </div>
      </div>

      <!-- Formulario -->
      <form class="space-y-6">
        
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-bold text-gray-900 dark:text-white mb-2">
              Fecha <span class="text-red-500">*</span>
            </label>
            <app-datepicker
              [value]="fechaEdicion()"
              (valueChange)="fechaEdicion.set($event)">
            </app-datepicker>
          </div>
          
          <div>
            <label class="block text-sm font-bold text-gray-900 dark:text-white mb-2">
              Hora <span class="text-red-500">*</span>
            </label>
            <input 
              type="time"
              [value]="horaEdicion()"
              (input)="horaEdicion.set(($any($event.target)).value)"
              class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-4 focus:ring-[#2E7D32]/20 focus:border-[#2E7D32]">
          </div>
        </div>

        <div>
          <label class="block text-sm font-bold text-gray-900 dark:text-white mb-2">Lugar</label>
          <input 
            type="text"
            [value]="lugarEdicion()"
            (input)="lugarEdicion.set(($any($event.target)).value)"
            placeholder="Complejo Deportivo..."
            class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-4 focus:ring-[#2E7D32]/20 focus:border-[#2E7D32]">
        </div>

        <div>
          <label class="block text-sm font-bold text-gray-900 dark:text-white mb-2">Mensaje (Opcional)</label>
          <textarea 
            [value]="mensajeEdicion()"
            (input)="mensajeEdicion.set(($any($event.target)).value)"
            rows="4"
            placeholder="Mensaje para los líderes..."
            class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-4 focus:ring-[#2E7D32]/20 focus:border-[#2E7D32] resize-none"></textarea>
        </div>

        <div class="flex gap-3 pt-4 border-t-2 border-gray-200 dark:border-gray-700">
          <button 
            type="button"
            (click)="cerrarEditarModal()"
            [disabled]="guardando()"
            class="flex-1 px-6 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-bold hover:bg-gray-100 dark:hover:bg-gray-800 transition-all disabled:opacity-50">
            Cancelar
          </button>
          <button 
            type="button"
            (click)="guardarCambiosPartido()"
            [disabled]="guardando() || !fechaEdicion() || !horaEdicion()"
            class="flex-1 px-6 py-3 rounded-xl bg-[#2E7D32] text-white font-bold hover:bg-[#1B5E20] transition-all disabled:opacity-50 flex items-center justify-center gap-2">
            <span *ngIf="guardando()" class="inline-block w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
            <span *ngIf="!guardando()" class="material-symbols-outlined">save</span>
            {{ guardando() ? 'Guardando...' : 'Guardar' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>