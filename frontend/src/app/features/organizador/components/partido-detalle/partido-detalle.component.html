<!-- TOAST -->
<app-toast
  [show]="showToast()"
  [type]="toastType()"
  [title]="toastTitle()"
  [message]="toastMessage()"
  (close)="cerrarToast()">
</app-toast>

<!-- CONTAINER PRINCIPAL -->
<div class="min-h-screen bg-gray-50 dark:bg-[#102211]">

  <!-- LOADING PRINCIPAL -->
  <div *ngIf="loading()" class="flex items-center justify-center py-20">
    <div class="text-center">
      <div class="inline-block w-16 h-16 border-4 border-gray-200 border-t-[#2E7D32] rounded-full animate-spin mb-4"></div>
      <p class="text-gray-600 dark:text-gray-400 font-medium">Cargando partido...</p>
    </div>
  </div>

  <!-- CONTENIDO -->
  <div *ngIf="!loading() && partido()" class="h-screen flex flex-col">

    <!-- ========================================== -->
    <!-- HEADER COMPACTO -->
    <!-- ========================================== -->
    <div class="flex-shrink-0 bg-white dark:bg-[#182c19] border-b-2 border-gray-200 dark:border-[#2a452b] px-4 sm:px-6 py-3">
      <div class="max-w-[1800px] mx-auto flex items-center justify-between">
        <!-- Bot√≥n volver -->
        <button
          (click)="volver()"
          class="w-10 h-10 rounded-lg border-2 border-gray-300 dark:border-gray-600 hover:border-[#2E7D32] hover:bg-green-50 dark:hover:bg-green-900/20 flex items-center justify-center transition-all group"
          aria-label="Volver">
          <span class="material-symbols-outlined text-gray-600 dark:text-gray-400 group-hover:text-[#2E7D32] text-xl">arrow_back</span>
        </button>

        <!-- Info del partido -->
        <div class="flex items-center gap-4">
          <div class="text-right">
            <p class="text-xs text-gray-500 dark:text-gray-400">{{ formatearFecha(partido()!.fecha_partido) }}</p>
            <p class="text-xs text-gray-600 dark:text-gray-300 font-semibold">Jornada {{ partido()?.jornada }}</p>
          </div>
          
          <span [class]="'inline-block px-3 py-1 rounded-full text-xs font-bold ' + getEstadoBadge(partido()!.estado).clase">
            {{ getEstadoBadge(partido()!.estado).texto }}
          </span>

          <span *ngIf="esIndoor()" 
                class="px-3 py-1 rounded-full bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 font-bold text-xs flex items-center gap-1">
            <span class="material-symbols-outlined text-sm">sports_soccer</span>
            Indoor
          </span>
          <span *ngIf="!esIndoor()" 
                class="px-3 py-1 rounded-full bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 font-bold text-xs flex items-center gap-1">
            <span class="material-symbols-outlined text-sm">sports_soccer</span>
            F√∫tbol 11
          </span>
        </div>
      </div>
    </div>

    <!-- ========================================== -->
    <!-- LAYOUT PRINCIPAL: 3 COLUMNAS -->
    <!-- ========================================== -->
    <div class="flex-1 overflow-hidden">
      <div class="h-full max-w-[1800px] mx-auto grid grid-cols-1 lg:grid-cols-12 gap-4 p-4">

        <!-- ========================================== -->
        <!-- COLUMNA IZQUIERDA: ALINEACIONES (40%) -->
        <!-- ========================================== -->
        <div class="lg:col-span-5 flex flex-col gap-4 overflow-y-auto custom-scrollbar">
          
          <!-- Header Alineaciones -->
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2">
              <span class="material-symbols-outlined text-[#2E7D32]">group</span>
              Alineaciones
            </h3>
            <button
              (click)="toggleAlineaciones()"
              class="px-3 py-1.5 rounded-lg bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 text-sm font-semibold hover:border-[#2E7D32] transition-all flex items-center gap-1">
              <span class="material-symbols-outlined text-sm">{{ mostrarAlineaciones() ? 'visibility_off' : 'visibility' }}</span>
              {{ mostrarAlineaciones() ? 'Ocultar' : 'Mostrar' }}
            </button>
          </div>

          <!-- Validaci√≥n de alineaciones -->
          <div *ngIf="!puedeIniciarPartido() && partido()?.estado === 'programado'" 
               class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 dark:border-yellow-700 rounded-lg p-3">
            <div class="flex items-center gap-2">
              <span class="material-symbols-outlined text-yellow-600 text-xl">warning</span>
              <div>
                <p class="font-bold text-yellow-800 dark:text-yellow-200 text-sm">Faltan alineaciones</p>
                <p class="text-xs text-yellow-700 dark:text-yellow-300 mt-1">
                  <span *ngIf="!tieneAlineacionLocal()">‚ùå {{ nombreEquipoLocal() }}</span>
                  <span *ngIf="tieneAlineacionLocal()">‚úÖ {{ nombreEquipoLocal() }}</span>
                  <br>
                  <span *ngIf="!tieneAlineacionVisitante()">‚ùå {{ nombreEquipoVisitante() }}</span>
                  <span *ngIf="tieneAlineacionVisitante()">‚úÖ {{ nombreEquipoVisitante() }}</span>
                </p>
              </div>
            </div>
          </div>

          <!-- Alineaciones -->
          <div *ngIf="mostrarAlineaciones()" class="space-y-4">
            
            <!-- EQUIPO LOCAL -->
            <div class="bg-white dark:bg-[#182c19] rounded-xl border border-gray-200 dark:border-[#2a452b] overflow-hidden">
              <div class="bg-gradient-to-r from-[#2E7D32] to-[#1B5E20] text-white px-4 py-2 flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center">
                    <span class="material-symbols-outlined text-lg">shield</span>
                  </div>
                  <div>
                    <h4 class="text-sm font-bold">{{ nombreEquipoLocal() }}</h4>
                    <p class="text-xs opacity-90">{{ alineacionLocal()?.formacion || (esIndoor() ? '1-2-2' : '4-4-2') }}</p>
                  </div>
                </div>
                <button
                  (click)="toggleVerAlineacionLocal()"
                  class="w-7 h-7 rounded-lg bg-white/20 hover:bg-white/30 flex items-center justify-center transition-all">
                  <span class="material-symbols-outlined text-sm">{{ verAlineacionLocal() ? 'visibility_off' : 'visibility' }}</span>
                </button>
              </div>

              <div *ngIf="verAlineacionLocal()" class="p-3">
                <div *ngIf="loadingAlineaciones()" class="text-center py-8">
                  <div class="inline-block w-8 h-8 border-4 border-gray-200 border-t-[#2E7D32] rounded-full animate-spin mb-2"></div>
                  <p class="text-xs text-gray-600 dark:text-gray-400">Cargando...</p>
                </div>

                <div *ngIf="!loadingAlineaciones() && !alineacionLocal()" class="text-center py-8">
                  <span class="material-symbols-outlined text-4xl text-gray-300 dark:text-gray-600 mb-2">group_off</span>
                  <p class="text-xs text-gray-600 dark:text-gray-400 font-semibold">Sin alineaci√≥n</p>
                </div>

                <div *ngIf="!loadingAlineaciones() && alineacionLocal()" class="space-y-3">
                  <!-- Cancha compacta -->
                  <div class="relative bg-gradient-to-b from-[#1a5c1e] to-[#2d7a32] rounded-lg overflow-hidden border-2 border-white h-[300px]">
                    <!-- L√≠neas -->
                    <div class="absolute inset-0">
                      <div class="absolute top-1/2 left-0 right-0 h-px bg-white/40"></div>
                      <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 border border-white/40 rounded-full"></div>
                      <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-1/3 h-10 border-2 border-t-2 border-white/40 rounded-t-lg"></div>
                    </div>

                    <!-- Jugadores titulares -->
                    <div *ngFor="let jugador of alineacionLocal()!.titulares; let i = index"
                         class="absolute transform -translate-x-1/2 -translate-y-1/2 cursor-pointer"
                         [class.selected]="jugadorSeleccionado() && jugadorSeleccionado()!.id_jugador === jugador.id_jugador"
                         [class.expulsado]="estadoJugadores()[jugador.id_jugador]?.expulsado"
                         [style]="obtenerPosicionJugador(jugador, i)"
                         (click)="seleccionarJugador(jugador, 'local')">
                      <div class="flex flex-col items-center jugador-card">
                        <div class="w-9 h-9 rounded-full bg-white border-2 border-[#2E7D32] shadow-lg overflow-hidden mb-1 relative">
                          <div class="w-full h-full bg-gradient-to-br from-[#2E7D32] to-[#1B5E20] flex items-center justify-center">
                            <span class="text-white font-bold text-sm">{{ jugador.dorsal }}</span>
                          </div>
                          <!-- Badges de eventos -->
                          <div class="absolute -top-1 -right-1 flex flex-col gap-0.5">
                            <span *ngIf="estadoJugadores()[jugador.id_jugador]?.goles" 
                                  class="badge-gol">‚öΩ{{ estadoJugadores()[jugador.id_jugador].goles }}</span>
                            <span *ngIf="estadoJugadores()[jugador.id_jugador]?.amarillas" 
                                  class="badge-yellow">üü®{{ estadoJugadores()[jugador.id_jugador].amarillas }}</span>
                            <span *ngIf="estadoJugadores()[jugador.id_jugador]?.rojas" 
                                  class="badge-red">üü•</span>
                          </div>
                        </div>
                        <div class="bg-white/95 dark:bg-gray-800/95 px-1.5 py-0.5 rounded shadow-md text-center">
                          <p class="text-[10px] font-bold text-gray-900 dark:text-white whitespace-nowrap leading-tight">{{ jugador.jugador_nombre }}</p>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Suplentes compactos -->
                  <div>
                    <h5 class="text-xs font-bold text-gray-900 dark:text-white mb-2 flex items-center gap-1">
                      <span class="material-symbols-outlined text-[#2E7D32] text-sm">person</span>
                      Suplentes ({{ alineacionLocal()!.suplentes.length }})
                    </h5>
                    <div class="grid grid-cols-2 gap-2">
                      <div *ngFor="let suplente of alineacionLocal()!.suplentes"
                           class="flex items-center gap-2 p-2 rounded-lg bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 cursor-pointer hover:border-[#2E7D32] transition-all"
                           [class.selected]="jugadorSeleccionado() && jugadorSeleccionado()!.id_jugador === suplente.id_jugador"
                           (click)="seleccionarJugador(suplente, 'local')">
                        <div class="w-7 h-7 rounded-full bg-gradient-to-br from-gray-400 to-gray-600 flex items-center justify-center text-white font-bold text-xs relative">
                          {{ suplente.dorsal }}
                          <!-- Badges -->
                          <div class="absolute -top-1 -right-1 flex flex-col gap-0.5">
                            <span *ngIf="estadoJugadores()[suplente.id_jugador]?.goles" class="badge-gol-sm">‚öΩ</span>
                            <span *ngIf="estadoJugadores()[suplente.id_jugador]?.amarillas" class="badge-yellow-sm">üü®</span>
                            <span *ngIf="estadoJugadores()[suplente.id_jugador]?.rojas" class="badge-red-sm">üü•</span>
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <p class="text-xs font-semibold text-gray-900 dark:text-white truncate">{{ suplente.jugador_nombre }}</p>
                          <p class="text-[10px] text-gray-600 dark:text-gray-400">{{ suplente.posicion }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- EQUIPO VISITANTE -->
            <div class="bg-white dark:bg-[#182c19] rounded-xl border border-gray-200 dark:border-[#2a452b] overflow-hidden">
              <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white px-4 py-2 flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center">
                    <span class="material-symbols-outlined text-lg">shield</span>
                  </div>
                  <div>
                    <h4 class="text-sm font-bold">{{ nombreEquipoVisitante() }}</h4>
                    <p class="text-xs opacity-90">{{ alineacionVisitante()?.formacion || (esIndoor() ? '1-2-2' : '4-4-2') }}</p>
                  </div>
                </div>
                <button
                  (click)="toggleVerAlineacionVisitante()"
                  class="w-7 h-7 rounded-lg bg-white/20 hover:bg-white/30 flex items-center justify-center transition-all">
                  <span class="material-symbols-outlined text-sm">{{ verAlineacionVisitante() ? 'visibility_off' : 'visibility' }}</span>
                </button>
              </div>

              <div *ngIf="verAlineacionVisitante()" class="p-3">
                <div *ngIf="loadingAlineaciones()" class="text-center py-8">
                  <div class="inline-block w-8 h-8 border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin mb-2"></div>
                  <p class="text-xs text-gray-600 dark:text-gray-400">Cargando...</p>
                </div>

                <div *ngIf="!loadingAlineaciones() && !alineacionVisitante()" class="text-center py-8">
                  <span class="material-symbols-outlined text-4xl text-gray-300 dark:text-gray-600 mb-2">group_off</span>
                  <p class="text-xs text-gray-600 dark:text-gray-400 font-semibold">Sin alineaci√≥n</p>
                </div>

                <div *ngIf="!loadingAlineaciones() && alineacionVisitante()" class="space-y-3">
                  <!-- Cancha compacta -->
                  <div class="relative bg-gradient-to-b from-[#1a5c1e] to-[#2d7a32] rounded-lg overflow-hidden border-2 border-white h-[300px]">
                    <div class="absolute inset-0">
                      <div class="absolute top-1/2 left-0 right-0 h-px bg-white/40"></div>
                      <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 border border-white/40 rounded-full"></div>
                      <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-1/3 h-10 border-2 border-t-2 border-white/40 rounded-t-lg"></div>
                    </div>

                    <div *ngFor="let jugador of alineacionVisitante()!.titulares; let i = index"
                         class="absolute transform -translate-x-1/2 -translate-y-1/2 cursor-pointer"
                         [class.selected]="jugadorSeleccionado() && jugadorSeleccionado()!.id_jugador === jugador.id_jugador"
                         [class.expulsado]="estadoJugadores()[jugador.id_jugador]?.expulsado"
                         [style]="obtenerPosicionJugador(jugador, i)"
                         (click)="seleccionarJugador(jugador, 'visitante')">
                      <div class="flex flex-col items-center jugador-card">
                        <div class="w-9 h-9 rounded-full bg-white border-2 border-blue-600 shadow-lg overflow-hidden mb-1 relative">
                          <div class="w-full h-full bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center">
                            <span class="text-white font-bold text-sm">{{ jugador.dorsal }}</span>
                          </div>
                          <div class="absolute -top-1 -right-1 flex flex-col gap-0.5">
                            <span *ngIf="estadoJugadores()[jugador.id_jugador]?.goles" class="badge-gol">‚öΩ{{ estadoJugadores()[jugador.id_jugador].goles }}</span>
                            <span *ngIf="estadoJugadores()[jugador.id_jugador]?.amarillas" class="badge-yellow">üü®{{ estadoJugadores()[jugador.id_jugador].amarillas }}</span>
                            <span *ngIf="estadoJugadores()[jugador.id_jugador]?.rojas" class="badge-red">üü•</span>
                          </div>
                        </div>
                        <div class="bg-white/95 dark:bg-gray-800/95 px-1.5 py-0.5 rounded shadow-md text-center">
                          <p class="text-[10px] font-bold text-gray-900 dark:text-white whitespace-nowrap leading-tight">{{ jugador.jugador_nombre }}</p>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Suplentes -->
                  <div>
                    <h5 class="text-xs font-bold text-gray-900 dark:text-white mb-2 flex items-center gap-1">
                      <span class="material-symbols-outlined text-blue-600 text-sm">person</span>
                      Suplentes ({{ alineacionVisitante()!.suplentes.length }})
                    </h5>
                    <div class="grid grid-cols-2 gap-2">
                      <div *ngFor="let suplente of alineacionVisitante()!.suplentes"
                           class="flex items-center gap-2 p-2 rounded-lg bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 cursor-pointer hover:border-blue-600 transition-all"
                           [class.selected]="jugadorSeleccionado() && jugadorSeleccionado()!.id_jugador === suplente.id_jugador"
                           (click)="seleccionarJugador(suplente, 'visitante')">
                        <div class="w-7 h-7 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center text-white font-bold text-xs relative">
                          {{ suplente.dorsal }}
                          <div class="absolute -top-1 -right-1 flex flex-col gap-0.5">
                            <span *ngIf="estadoJugadores()[suplente.id_jugador]?.goles" class="badge-gol-sm">‚öΩ</span>
                            <span *ngIf="estadoJugadores()[suplente.id_jugador]?.amarillas" class="badge-yellow-sm">üü®</span>
                            <span *ngIf="estadoJugadores()[suplente.id_jugador]?.rojas" class="badge-red-sm">üü•</span>
                          </div>
                        </div>
                        <div class="flex-1 min-w-0">
                          <p class="text-xs font-semibold text-gray-900 dark:text-white truncate">{{ suplente.jugador_nombre }}</p>
                          <p class="text-[10px] text-gray-600 dark:text-gray-400">{{ suplente.posicion }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- ========================================== -->
        <!-- COLUMNA CENTRAL: MARCADOR Y CONTROLES (35%) -->
        <!-- ========================================== -->
        <div class="lg:col-span-4 flex flex-col gap-4 overflow-y-auto custom-scrollbar">
          
          <!-- MARCADOR COMPACTO -->
          <div class="bg-white dark:bg-[#182c19] rounded-xl shadow-lg border border-gray-200 dark:border-[#2a452b] p-4">
            <!-- Equipos y marcador -->
            <div class="grid grid-cols-3 gap-3 items-center mb-4">
              <!-- Local -->
              <div class="text-center">
                <div class="w-12 h-12 mx-auto mb-2 rounded-full overflow-hidden border-2 border-gray-200 dark:border-gray-700 flex items-center justify-center shadow-md">
                  <app-image-placeholder
                    [src]="alineacionLocal()?.logo_url || null"
                    [type]="'team'"
                    [size]="'md'"
                    [alt]="'Logo de ' + nombreEquipoLocal()">
                  </app-image-placeholder>
                </div>
                <h3 class="text-sm font-bold text-gray-900 dark:text-white leading-tight">{{ nombreEquipoLocal() }}</h3>
                <p class="text-[10px] text-gray-500 dark:text-gray-400 font-semibold">LOCAL</p>
              </div>

              <!-- Marcador -->
              <div class="text-center">
                <div class="bg-gray-100 dark:bg-gray-800 rounded-xl p-3 border border-gray-200 dark:border-gray-700">
                  <div class="text-4xl font-bold text-gray-900 dark:text-white">
                    {{ golesLocal() }} <span class="text-gray-400">-</span> {{ golesVisitante() }}
                  </div>
                </div>
              </div>

              <!-- Visitante -->
              <div class="text-center">
                <div class="w-12 h-12 mx-auto mb-2 rounded-full overflow-hidden border-2 border-gray-200 dark:border-gray-700 flex items-center justify-center shadow-md">
                  <app-image-placeholder
                    [src]="alineacionVisitante()?.logo_url || null"
                    [type]="'team'"
                    [size]="'md'"
                    [alt]="'Logo de ' + nombreEquipoVisitante()">
                  </app-image-placeholder>
                </div>
                <h3 class="text-sm font-bold text-gray-900 dark:text-white leading-tight">{{ nombreEquipoVisitante() }}</h3>
                <p class="text-[10px] text-gray-500 dark:text-gray-400 font-semibold">VISITANTE</p>
              </div>
            </div>

            <!-- Tarjetas -->
            <div class="grid grid-cols-4 gap-2">
              <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 rounded-lg p-2 text-center border border-yellow-200 dark:border-yellow-700">
                <p class="text-[10px] text-gray-600 dark:text-gray-400 mb-1">üü® Local</p>
                <span class="text-2xl font-bold text-gray-900 dark:text-white">{{ tarjetasAmarillasLocal() }}</span>
              </div>
              <div class="bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 rounded-lg p-2 text-center border border-red-200 dark:border-red-700">
                <p class="text-[10px] text-gray-600 dark:text-gray-400 mb-1">üü• Local</p>
                <span class="text-2xl font-bold text-gray-900 dark:text-white">{{ tarjetasRojasLocal() }}</span>
              </div>
              <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 rounded-lg p-2 text-center border border-yellow-200 dark:border-yellow-700">
                <p class="text-[10px] text-gray-600 dark:text-gray-400 mb-1">üü® Visit.</p>
                <span class="text-2xl font-bold text-gray-900 dark:text-white">{{ tarjetasAmarillasVisitante() }}</span>
              </div>
              <div class="bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 rounded-lg p-2 text-center border border-red-200 dark:border-red-700">
                <p class="text-[10px] text-gray-600 dark:text-gray-400 mb-1">üü• Visit.</p>
                <span class="text-2xl font-bold text-gray-900 dark:text-white">{{ tarjetasRojasVisitante() }}</span>
              </div>
            </div>
          </div>

          <!-- CRON√ìMETRO COMPACTO -->
          <div class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl p-4 border border-gray-200 dark:border-gray-700">
            <div class="text-center mb-3">
              <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 mb-2">
                <span class="material-symbols-outlined text-[#2E7D32] text-sm">schedule</span>
                <p class="text-xs font-bold text-gray-900 dark:text-white">{{ getTiempoTexto() }}</p>
              </div>

              <div class="text-4xl font-mono font-bold text-gray-900 dark:text-white mb-1">
                {{ tiempoFormateado() }}
              </div>

              <p class="text-sm font-semibold text-gray-700 dark:text-gray-300">
                Minuto {{ minutoJuego() }}'
              </p>
              <p class="text-xs text-gray-500 dark:text-gray-400">
                {{ getTiempoReal() }}
              </p>
            </div>

            <!-- Velocidad -->
            <div class="flex justify-center gap-1 mb-3 pb-3 border-b border-gray-300 dark:border-gray-700">
              <button
                (click)="cambiarVelocidad(1)"
                [class]="'px-3 py-1 rounded-lg text-xs font-bold transition-all border ' + 
                         (velocidadActual() === 1 
                           ? 'bg-blue-100 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-300' 
                           : 'bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 border-gray-300 dark:border-gray-600')">
                üê¢ 1x
              </button>
              <button
                (click)="cambiarVelocidad(10)"
                [class]="'px-3 py-1 rounded-lg text-xs font-bold transition-all border ' + 
                         (velocidadActual() === 10 
                           ? 'bg-orange-100 text-orange-700 border-orange-300 dark:bg-orange-900/30 dark:text-orange-300' 
                           : 'bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 border-gray-300 dark:border-gray-600')">
                üèÉ 10x
              </button>
              <button
                (click)="cambiarVelocidad(60)"
                [class]="'px-3 py-1 rounded-lg text-xs font-bold transition-all border ' + 
                         (velocidadActual() === 60 
                           ? 'bg-yellow-100 text-yellow-700 border-yellow-300 dark:bg-yellow-900/30 dark:text-yellow-300' 
                           : 'bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 border-gray-300 dark:border-gray-600')">
                ‚ö° 60x
              </button>
            </div>

            <!-- Controles cron√≥metro -->
            <div class="flex flex-wrap justify-center gap-2">
              <button
                *ngIf="!cronometroActivo() && partido()?.estado === 'en_juego' && tiempoActual() !== 'descanso' && tiempoActual() !== 'finalizado'"
                (click)="iniciarCronometro()"
                class="px-4 py-2 rounded-lg bg-[#2E7D32] hover:bg-[#1B5E20] text-white text-sm font-bold flex items-center gap-1 transition-all shadow-md">
                <span class="material-symbols-outlined text-sm">play_arrow</span>
                Iniciar
              </button>

              <button
                *ngIf="cronometroActivo()"
                (click)="pausarCronometro()"
                class="px-4 py-2 rounded-lg bg-orange-500 hover:bg-orange-600 text-white text-sm font-bold flex items-center gap-1 transition-all shadow-md">
                <span class="material-symbols-outlined text-sm">pause</span>
                Pausar
              </button>

              <button
                *ngIf="tiempoActual() === 'descanso' && partido()?.estado === 'en_juego'"
                (click)="iniciarSegundoTiempo()"
                class="px-4 py-2 rounded-lg bg-green-600 hover:bg-green-700 text-white text-sm font-bold flex items-center gap-1 transition-all shadow-md animate-pulse">
                <span class="material-symbols-outlined text-sm">play_circle</span>
                2do Tiempo
              </button>

              <button
                *ngIf="partido()?.estado === 'en_juego' && tiempoActual() === 'finalizado'"
                (click)="agregarTiempoAdicional()"
                class="px-4 py-2 rounded-lg bg-yellow-500 hover:bg-yellow-600 text-white text-sm font-bold flex items-center gap-1 transition-all shadow-md">
                <span class="material-symbols-outlined text-sm">add_circle</span>
                +5 min
              </button>

              <button
                *ngIf="partido()?.estado === 'en_juego'"
                (click)="reiniciarCronometro()"
                class="px-4 py-2 rounded-lg bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 text-sm font-bold flex items-center gap-1 transition-all border border-gray-300 dark:border-gray-600">
                <span class="material-symbols-outlined text-sm">restart_alt</span>
                Reset
              </button>
            </div>
          </div>

          <!-- REGISTRO DE EVENTOS -->
          <div class="bg-white dark:bg-[#182c19] rounded-xl border border-gray-200 dark:border-[#2a452b] p-4">
            <h3 class="text-sm font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2">
              <span class="material-symbols-outlined text-[#2E7D32]">event</span>
              Registrar Evento
            </h3>

            <!-- Panel de jugador seleccionado -->
            <div *ngIf="jugadorSeleccionado()" class="mb-3 p-3 bg-gradient-to-r from-blue-50 to-green-50 dark:from-blue-900/20 dark:to-green-900/20 rounded-lg border border-blue-200 dark:border-blue-700">
              <div class="flex items-center justify-between mb-2">
                <div>
                  <p class="text-xs text-gray-600 dark:text-gray-400">Jugador seleccionado</p>
                  <p class="font-bold text-gray-900 dark:text-white">#{{ jugadorSeleccionado()!.dorsal }} {{ jugadorSeleccionado()!.jugador_nombre }}</p>
                  <p class="text-xs text-gray-600 dark:text-gray-300">{{ equipoSeleccionado() === 'local' ? nombreEquipoLocal() : nombreEquipoVisitante() }}</p>
                </div>
                <button
                  (click)="jugadorSeleccionado.set(null)"
                  class="w-8 h-8 rounded-lg bg-white dark:bg-gray-800 hover:bg-red-50 dark:hover:bg-red-900/20 border border-gray-300 dark:border-gray-600 flex items-center justify-center transition-all">
                  <span class="material-symbols-outlined text-red-600 text-sm">close</span>
                </button>
              </div>

              <div class="grid grid-cols-3 gap-2">
                <button
                  (click)="registrarEvento('gol')"
                  [disabled]="partido()?.estado !== 'en_juego'"
                  class="px-3 py-2 rounded-lg bg-[#2E7D32] text-white text-xs font-bold hover:bg-[#1B5E20] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1 transition-all">
                  <span class="material-symbols-outlined text-sm">sports_soccer</span>
                  Gol
                </button>

                <button
                  (click)="registrarEvento('tarjeta_amarilla')"
                  [disabled]="partido()?.estado !== 'en_juego'"
                  class="px-3 py-2 rounded-lg bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 text-xs font-bold border border-yellow-400 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1 transition-all">
                  üü®
                </button>

                <button
                  (click)="registrarEvento('tarjeta_roja')"
                  [disabled]="partido()?.estado !== 'en_juego'"
                  class="px-3 py-2 rounded-lg bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 text-xs font-bold border border-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1 transition-all">
                  üü•
                </button>
              </div>
            </div>

            <!-- Mensaje informativo -->
            <div *ngIf="!jugadorSeleccionado()" class="text-center py-6 bg-gray-50 dark:bg-gray-800 rounded-lg border border-dashed border-gray-300 dark:border-gray-600">
              <span class="material-symbols-outlined text-4xl text-gray-300 dark:text-gray-600 mb-2">touch_app</span>
              <p class="text-xs text-gray-600 dark:text-gray-400 font-medium">Selecciona un jugador de las alineaciones</p>
            </div>
          </div>

          <!-- CONTROLES DEL PARTIDO -->
          <div class="bg-white dark:bg-[#182c19] rounded-xl border border-gray-200 dark:border-[#2a452b] p-4">
            <h3 class="text-sm font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2">
              <span class="material-symbols-outlined text-[#2E7D32]">settings</span>
              Control
            </h3>

            <div class="space-y-2">
              <button
                *ngIf="partido()?.estado === 'programado'"
                (click)="iniciarPartido()"
                [disabled]="!puedeIniciarPartido()"
                class="w-full px-4 py-3 rounded-lg bg-[#2E7D32] text-white text-sm font-bold hover:bg-[#1B5E20] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-all shadow-md">
                <span class="material-symbols-outlined">play_circle</span>
                {{ puedeIniciarPartido() ? 'Iniciar Partido' : 'Esperando alineaciones...' }}
              </button>

              <button
                *ngIf="partido()?.estado === 'en_juego'"
                (click)="finalizarPartido()"
                class="w-full px-4 py-3 rounded-lg bg-red-600 text-white text-sm font-bold hover:bg-red-700 flex items-center justify-center gap-2 transition-all shadow-md">
                <span class="material-symbols-outlined">stop_circle</span>
                Finalizar Partido
              </button>
            </div>
          </div>

        </div>

        <!-- ========================================== -->
        <!-- COLUMNA DERECHA: CRONOLOG√çA (25%) -->
        <!-- ========================================== -->
        <div class="lg:col-span-3 flex flex-col bg-white dark:bg-[#182c19] rounded-xl border border-gray-200 dark:border-[#2a452b] overflow-hidden">
          <div class="flex-shrink-0 bg-gradient-to-r from-[#2E7D32] to-[#1B5E20] text-white px-4 py-3 flex items-center gap-2">
            <span class="material-symbols-outlined">timeline</span>
            <h3 class="text-sm font-bold">Cronolog√≠a</h3>
            <span class="ml-auto px-2 py-0.5 rounded-full bg-white/20 text-xs font-bold">{{ eventos().length }}</span>
          </div>

          <div class="flex-1 overflow-y-auto custom-scrollbar p-4">
            <div *ngIf="eventos().length === 0" class="text-center py-12">
              <span class="material-symbols-outlined text-6xl text-gray-300 dark:text-gray-600 mb-3">event_note</span>
              <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">Sin eventos</p>
              <p class="text-xs text-gray-500 dark:text-gray-500 mt-1">Los eventos aparecer√°n aqu√≠</p>
            </div>

            <div *ngIf="eventos().length > 0" class="space-y-2">
              <div *ngFor="let evento of eventosOrdenados()"
                   class="flex items-start gap-3 p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-[#2E7D32] transition-all bg-gray-50 dark:bg-gray-800/50">
                
                <div class="flex-shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-[#2E7D32] to-[#1B5E20] flex items-center justify-center text-white font-bold shadow-md">
                  <div class="text-center">
                    <div class="text-lg leading-none">{{ evento.minuto }}</div>
                    <div class="text-[8px] opacity-80">'</div>
                  </div>
                </div>

                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2 mb-1">
                    <span *ngIf="evento.tipo === 'gol'" class="material-symbols-outlined text-green-600 text-lg">sports_soccer</span>
                    <div *ngIf="evento.tipo === 'tarjeta_amarilla'" class="w-3 h-4 bg-yellow-400 rounded border border-yellow-600"></div>
                    <div *ngIf="evento.tipo === 'tarjeta_roja'" class="w-3 h-4 bg-red-500 rounded border border-red-700"></div>

                    <p class="font-bold text-sm text-gray-900 dark:text-white">
                      {{ evento.tipo === 'gol' ? '‚öΩ GOL' :
                         evento.tipo === 'tarjeta_amarilla' ? 'üü® Tarjeta Amarilla' :
                         'üü• Tarjeta Roja' }}
                    </p>
                  </div>
                  <p class="text-xs text-gray-600 dark:text-gray-400">
                    <span class="font-semibold">{{ evento.equipo_nombre }}</span>
                    <br>
                    <span *ngIf="evento.jugador_nombre">
                      #{{ evento.jugador_dorsal }} {{ evento.jugador_nombre }}
                    </span>
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>