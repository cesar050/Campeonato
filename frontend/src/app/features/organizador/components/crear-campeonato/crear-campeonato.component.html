<!-- ALERTA FLOTANTE -->
<div *ngIf="mostrarAlerta()" 
     class="fixed top-4 right-4 z-50 animate-slide-in-right">
  <div class="max-w-md rounded-lg shadow-2xl border-l-4 p-4"
       [ngClass]="{
         'bg-green-50 border-green-500': tipoAlerta() === 'success',
         'bg-red-50 border-red-500': tipoAlerta() === 'error',
         'bg-yellow-50 border-yellow-500': tipoAlerta() === 'warning'
       }">
    <div class="flex items-start gap-3">
      <span class="material-symbols-outlined text-2xl"
            [ngClass]="{
              'text-green-600': tipoAlerta() === 'success',
              'text-red-600': tipoAlerta() === 'error',
              'text-yellow-600': tipoAlerta() === 'warning'
            }">
        {{ tipoAlerta() === 'success' ? 'check_circle' : tipoAlerta() === 'error' ? 'error' : 'warning' }}
      </span>
      <div class="flex-1">
        <p class="font-semibold"
           [ngClass]="{
             'text-green-800': tipoAlerta() === 'success',
             'text-red-800': tipoAlerta() === 'error',
             'text-yellow-800': tipoAlerta() === 'warning'
           }">
          {{ mensajeAlerta() }}
        </p>
      </div>
      <button (click)="cerrarAlerta()" 
              class="text-gray-400 hover:text-gray-600">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>
  </div>
</div>

<!-- CONTENEDOR PRINCIPAL - PANTALLA COMPLETA -->
<div class="min-h-screen bg-gray-50 dark:bg-[#102211]">
  <div class="max-w-5xl mx-auto px-4 py-6">
    
    <!-- HEADER CON BOTÓN VOLVER MÁS VISIBLE -->
    <div class="mb-8">
      <button 
        (click)="volver()"
        class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-white dark:bg-[#182c19] border-2 border-gray-200 dark:border-[#2a452b] text-gray-700 dark:text-gray-300 hover:border-[#2E7D32] hover:text-[#2E7D32] transition-all shadow-sm mb-6">
        <span class="material-symbols-outlined">arrow_back</span>
        <span class="font-semibold">Volver al Dashboard</span>
      </button>
      
      <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-2">
        Crear un Nuevo Campeonato
      </h1>
      <p class="text-gray-600 dark:text-gray-400">
        Configura tu campeonato en 3 simples pasos
      </p>
    </div>

    <!-- STEPPER -->
    <div class="mb-10">
      <div class="flex items-center justify-between max-w-3xl mx-auto">
        <!-- Paso 1 -->
        <div class="flex flex-col items-center flex-1">
          <div class="w-14 h-14 rounded-full flex items-center justify-center font-bold text-lg border-4 transition-all"
               [class]="pasoActual() >= 1 ? 'bg-[#2E7D32] border-[#2E7D32] text-white' : 'bg-white border-gray-300 text-gray-400'">
            <span *ngIf="pasoActual() > 1" class="material-symbols-outlined text-2xl">check</span>
            <span *ngIf="pasoActual() === 1">1</span>
          </div>
          <p class="mt-3 text-sm font-bold" [class.text-[#2E7D32]]="pasoActual() >= 1" [class.text-gray-500]="pasoActual() < 1">
            INFORMACIÓN
          </p>
          <p class="text-xs text-gray-500">Datos Básicos</p>
        </div>

        <div class="flex-1 h-1 -mx-2" [class]="pasoActual() >= 2 ? 'bg-[#2E7D32]' : 'bg-gray-300'"></div>

        <!-- Paso 2 -->
        <div class="flex flex-col items-center flex-1">
          <div class="w-14 h-14 rounded-full flex items-center justify-center font-bold text-lg border-4 transition-all"
               [class]="pasoActual() >= 2 ? 'bg-[#2E7D32] border-[#2E7D32] text-white' : 'bg-white border-gray-300 text-gray-400'">
            <span *ngIf="pasoActual() > 2" class="material-symbols-outlined text-2xl">check</span>
            <span *ngIf="pasoActual() <= 2">2</span>
          </div>
          <p class="mt-3 text-sm font-bold" [class.text-[#2E7D32]]="pasoActual() >= 2" [class.text-gray-500]="pasoActual() < 2">
            CONFIGURACIÓN
          </p>
          <p class="text-xs text-gray-500">Reglas del Torneo</p>
        </div>

        <div class="flex-1 h-1 -mx-2" [class]="pasoActual() >= 3 ? 'bg-[#2E7D32]' : 'bg-gray-300'"></div>

        <!-- Paso 3 -->
        <div class="flex flex-col items-center flex-1">
          <div class="w-14 h-14 rounded-full flex items-center justify-center font-bold text-lg border-4 transition-all"
               [class]="pasoActual() >= 3 ? 'bg-[#2E7D32] border-[#2E7D32] text-white' : 'bg-white border-gray-300 text-gray-400'">
            3
          </div>
          <p class="mt-3 text-sm font-bold" [class.text-[#2E7D32]]="pasoActual() >= 3" [class.text-gray-500]="pasoActual() < 3">
            CONFIRMACIÓN
          </p>
          <p class="text-xs text-gray-500">Revisión Final</p>
        </div>
      </div>
    </div>

    <!-- FORMULARIO -->
    <form [formGroup]="formulario" class="bg-white dark:bg-[#182c19] rounded-2xl border-2 border-gray-200 dark:border-[#2a452b] shadow-xl">
      
      <!-- PASO 1 -->
      <div *ngIf="pasoActual() === 1" class="p-8">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
          Paso 1: Información Básica
        </h2>
        <p class="text-gray-600 dark:text-gray-400 mb-8">
          Comienza ingresando los detalles principales de tu campeonato.
        </p>

        <div class="space-y-6">
          <!-- Nombre -->
          <div>
            <label class="block text-sm font-bold text-gray-900 dark:text-white mb-2">
              Nombre del Campeonato <span class="text-red-500">*</span>
            </label>
            <input 
              type="text"
              formControlName="nombre"
              placeholder="Ej: Copa de Verano 2024"
              class="w-full px-4 py-4 text-lg rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-4 focus:ring-[#2E7D32]/20 focus:border-[#2E7D32] transition-all">
          </div>

          <!-- Descripción -->
          <div>
            <label class="block text-sm font-bold text-gray-900 dark:text-white mb-2">
              Descripción del Campeonato <span class="text-red-500">*</span>
            </label>
            <textarea 
              formControlName="descripcion"
              rows="4"
              placeholder="Describe tu campeonato. Ejemplo: El torneo de fútbol amateur más emocionante de la temporada. Reúne a los mejores equipos de la región para competir por la gloria."
              class="w-full px-4 py-4 text-lg rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-4 focus:ring-[#2E7D32]/20 focus:border-[#2E7D32] transition-all resize-none"></textarea>
          </div>

          <!-- Tipo de Deporte -->
          <div>
            <label class="block text-sm font-bold text-gray-900 dark:text-white mb-3">
              Tipo de Deporte <span class="text-red-500">*</span>
            </label>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div *ngFor="let tipo of tiposDeporte"
                   (click)="seleccionarTipoDeporte(tipo.value)"
                   class="p-5 rounded-xl border-3 cursor-pointer transition-all hover:scale-105"
                   [class]="formulario.get('tipo_deporte')?.value === tipo.value 
                     ? 'border-[#2E7D32] bg-green-50 dark:bg-green-900/20 shadow-lg' 
                     : 'border-gray-300 dark:border-gray-600 hover:border-[#2E7D32]/50'">
                <div class="flex items-start gap-4">
                  <div class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"
                       [class]="formulario.get('tipo_deporte')?.value === tipo.value 
                         ? 'bg-[#2E7D32] text-white' 
                         : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300'">
                    <span class="material-symbols-outlined text-2xl">{{ tipo.icon }}</span>
                  </div>
                  <div class="flex-1">
                    <h3 class="font-bold text-lg text-gray-900 dark:text-white">{{ tipo.label }}</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">{{ tipo.descripcion }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- PASO 2 -->
      <div *ngIf="pasoActual() === 2" class="p-8">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
          Paso 2: Configuración del Torneo
        </h2>
        <p class="text-gray-600 dark:text-gray-400 mb-8">
          Define las reglas y el calendario de tu campeonato.
        </p>

        <div class="space-y-6">
          <!-- Fechas CON DATEPICKER PERSONALIZADO -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-bold text-gray-900 dark:text-white mb-2">
                Fecha de Inicio <span class="text-red-500">*</span>
              </label>
              <app-datepicker
                [value]="formulario.get('fecha_inicio')?.value"
                (valueChange)="onFechaChange('fecha_inicio', $event)"
                placeholder="Selecciona la fecha de inicio">
              </app-datepicker>
            </div>

            <div>
              <label class="block text-sm font-bold text-gray-900 dark:text-white mb-2">
                Fecha de Fin <span class="text-red-500">*</span>
              </label>
              <app-datepicker
                [value]="formulario.get('fecha_fin')?.value"
                [minDate]="formulario.get('fecha_inicio')?.value"
                (valueChange)="onFechaChange('fecha_fin', $event)"
                placeholder="Selecciona la fecha de fin">
              </app-datepicker>
            </div>
          </div>

          <!-- Máximo de Equipos - EDITABLE DIRECTO -->
          <div>
            <label class="block text-sm font-bold text-gray-900 dark:text-white mb-2">
              Máximo de Equipos <span class="text-red-500">*</span>
            </label>
            <input 
              type="text"
              formControlName="max_equipos"
              (input)="onMaxEquiposChange($event)"
              (blur)="onMaxEquiposBlur($event)"
              placeholder="Ejemplo: 16"
              class="w-full px-6 py-5 text-3xl font-bold text-center rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-4 focus:ring-[#2E7D32]/20 focus:border-[#2E7D32] transition-all">
            <p class="mt-2 text-sm text-gray-500 text-center">Mínimo 2 equipos, máximo 64 equipos</p>
          </div>

          <!-- Tipo de Competición -->
          <div>
            <label class="block text-sm font-bold text-gray-900 dark:text-white mb-3">
              Tipo de Competición <span class="text-red-500">*</span>
            </label>
            <div class="space-y-3">
              <div *ngFor="let tipo of tiposCompeticion"
                   (click)="seleccionarTipoCompeticion(tipo.value)"
                   class="p-5 rounded-xl border-3 cursor-pointer transition-all hover:scale-102"
                   [class]="formulario.get('tipo_competicion')?.value === tipo.value 
                     ? 'border-[#2E7D32] bg-green-50 dark:bg-green-900/20 shadow-lg' 
                     : 'border-gray-300 dark:border-gray-600 hover:border-[#2E7D32]/50'">
                <div class="flex items-start gap-4">
                  <div class="w-8 h-8 rounded-full border-3 flex items-center justify-center mt-1 flex-shrink-0"
                       [class]="formulario.get('tipo_competicion')?.value === tipo.value 
                         ? 'border-[#2E7D32]' 
                         : 'border-gray-300'">
                    <div *ngIf="formulario.get('tipo_competicion')?.value === tipo.value" 
                         class="w-4 h-4 rounded-full bg-[#2E7D32]"></div>
                  </div>
                  <div class="flex-1">
                    <h3 class="font-bold text-lg text-gray-900 dark:text-white">{{ tipo.label }}</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">{{ tipo.descripcion }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div>
        <label class="block text-sm font-bold text-gray-900 dark:text-white mb-3">
          Visibilidad del Campeonato <span class="text-red-500">*</span>
        </label>
        
        <div class="space-y-3">
          <!-- Opción: PÚBLICO -->
          <div (click)="formulario.patchValue({es_publico: true})"
               class="p-5 rounded-xl border-3 cursor-pointer transition-all hover:scale-102"
               [class]="formulario.get('es_publico')?.value === true 
                 ? 'border-[#2E7D32] bg-green-50 dark:bg-green-900/20 shadow-lg' 
                 : 'border-gray-300 dark:border-gray-600 hover:border-[#2E7D32]/50'">
            <div class="flex items-start gap-4">
              <div class="w-8 h-8 rounded-full border-3 flex items-center justify-center mt-1 flex-shrink-0"
                   [class]="formulario.get('es_publico')?.value === true 
                     ? 'border-[#2E7D32]' 
                     : 'border-gray-300'">
                <div *ngIf="formulario.get('es_publico')?.value === true" 
                     class="w-4 h-4 rounded-full bg-[#2E7D32]"></div>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-1">
                  <span class="material-symbols-outlined text-[#2E7D32]">public</span>
                  <h3 class="font-bold text-lg text-gray-900 dark:text-white">Campeonato Público</h3>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-400">
                  Cualquier líder de equipo podrá ver este campeonato y solicitar inscripción libremente. 
                  Ideal para torneos abiertos a la comunidad.
                </p>
              </div>
            </div>
          </div>
      
          <!-- Opción: PRIVADO -->
          <div (click)="formulario.patchValue({es_publico: false})"
               class="p-5 rounded-xl border-3 cursor-pointer transition-all hover:scale-102"
               [class]="formulario.get('es_publico')?.value === false 
                 ? 'border-[#2E7D32] bg-green-50 dark:bg-green-900/20 shadow-lg' 
                 : 'border-gray-300 dark:border-gray-600 hover:border-[#2E7D32]/50'">
            <div class="flex items-start gap-4">
              <div class="w-8 h-8 rounded-full border-3 flex items-center justify-center mt-1 flex-shrink-0"
                   [class]="formulario.get('es_publico')?.value === false 
                     ? 'border-[#2E7D32]' 
                     : 'border-gray-300'">
                <div *ngIf="formulario.get('es_publico')?.value === false" 
                     class="w-4 h-4 rounded-full bg-[#2E7D32]"></div>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-1">
                  <span class="material-symbols-outlined text-amber-600">lock</span>
                  <h3 class="font-bold text-lg text-gray-900 dark:text-white">Campeonato Privado</h3>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-400">
                  Solo equipos con código de inscripción podrán solicitar unirse. 
                  Recibirás un código único al crear el campeonato. 
                  Perfecto para ligas cerradas o invitacionales.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- PASO 3 -->
      <div *ngIf="pasoActual() === 3" class="p-8">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
          Paso 3: Revisión Final
        </h2>
        <p class="text-gray-600 dark:text-gray-400 mb-8">
          Revisa la información antes de crear tu campeonato.
        </p>

        <div class="space-y-5 bg-gray-50 dark:bg-gray-800/50 rounded-xl p-6">
          <div>
            <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 mb-1">Nombre</h4>
            <p class="text-xl font-bold text-gray-900 dark:text-white">{{ formulario.get('nombre')?.value }}</p>
          </div>

          <div>
            <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 mb-1">Descripción</h4>
            <p class="text-gray-900 dark:text-white">{{ formulario.get('descripcion')?.value }}</p>
          </div>

          <div class="grid grid-cols-2 gap-5">
            <div>
              <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 mb-1">Tipo de Deporte</h4>
              <p class="text-gray-900 dark:text-white font-semibold">
                {{ formulario.get('tipo_deporte')?.value === 'futbol' ? 'Fútbol 11' : 'Fútbol Indoor' }}
              </p>
            </div>

            <div>
              <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 mb-1">Tipo de Competición</h4>
              <p class="text-gray-900 dark:text-white font-semibold">
                {{ formulario.get('tipo_competicion')?.value === 'liga' ? 'Liga' : 
                   formulario.get('tipo_competicion')?.value === 'eliminacion_directa' ? 'Eliminación Directa' : 'Mixto' }}
              </p>
            </div>

            <div>
              <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 mb-1">Fecha Inicio</h4>
              <p class="text-gray-900 dark:text-white font-semibold">{{ formulario.get('fecha_inicio')?.value }}</p>
            </div>

            <div>
              <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 mb-1">Fecha Fin</h4>
              <p class="text-gray-900 dark:text-white font-semibold">{{ formulario.get('fecha_fin')?.value }}</p>
            </div>

            <div>
              <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 mb-1">Máximo de Equipos</h4>
              <p class="text-gray-900 dark:text-white font-semibold">{{ formulario.get('max_equipos')?.value }} equipos</p>
            </div>
          </div>
        </div>
      </div>

      <div>
        <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 mb-1">Visibilidad</h4>
        <div class="flex items-center gap-2">
          <span class="material-symbols-outlined" 
                [class.text-green-600]="formulario.get('es_publico')?.value"
                [class.text-amber-600]="!formulario.get('es_publico')?.value">
            {{ formulario.get('es_publico')?.value ? 'public' : 'lock' }}
          </span>
          <p class="text-gray-900 dark:text-white font-semibold">
            {{ formulario.get('es_publico')?.value ? 'Campeonato Público' : 'Campeonato Privado' }}
          </p>
        </div>
        <p *ngIf="!formulario.get('es_publico')?.value" class="text-sm text-amber-600 mt-1">
          Se generará un código de inscripción automáticamente
        </p>
      </div>

      <!-- BOTONES FIJOS ABAJO -->
      <div class="flex justify-between items-center p-8 bg-gray-50 dark:bg-gray-800/30 border-t-2 border-gray-200 dark:border-gray-700 rounded-b-2xl">
        <button 
          *ngIf="pasoActual() > 1"
          type="button"
          (click)="pasoAnterior()"
          class="px-8 py-4 rounded-xl border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-bold hover:bg-gray-100 dark:hover:bg-gray-800 transition-all text-lg">
          Atrás
        </button>

        <div class="ml-auto">
          <button 
            *ngIf="pasoActual() < 3"
            type="button"
            (click)="siguientePaso()"
            class="px-10 py-4 rounded-xl bg-[#2E7D32] text-white font-bold hover:bg-[#1B5E20] transition-all flex items-center gap-3 text-lg shadow-lg hover:shadow-xl">
            Siguiente
            <span class="material-symbols-outlined text-2xl">arrow_forward</span>
          </button>

          <button 
            *ngIf="pasoActual() === 3"
            type="button"
            (click)="crearCampeonato()"
            [disabled]="loading()"
            class="px-10 py-4 rounded-xl bg-[#2E7D32] text-white font-bold hover:bg-[#1B5E20] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-3 text-lg shadow-lg hover:shadow-xl">
            <span *ngIf="loading()" class="animate-spin material-symbols-outlined">progress_activity</span>
            {{ loading() ? 'Creando...' : 'Crear Campeonato' }}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>