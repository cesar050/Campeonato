<div class="dashboard-container">
  <!-- HEADER -->
  <div class="page-header">
    <div class="header-content">
      <h1>Resumen General</h1>
      <p class="subtitle">Métricas clave de la plataforma</p>
    </div>
    <div class="header-meta">
      <span class="last-update">Actualizado: {{ getCurrentDate() }}</span>
    </div>
  </div>

  <!-- LOADING STATE -->
  @if (isLoading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando estadísticas...</p>
    </div>
  } @else {
    <!-- STATS CARDS -->
    <div class="stats-grid">
      <!-- CAMPEONATOS ACTIVOS -->
      <div class="stat-card">
        <div class="stat-icon blue">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="8" r="7"></circle>
            <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-label">Campeonatos Activos</div>
          <div class="stat-value">{{ stats().campeonatos_activos }}</div>
          @if (stats().trend_campeonatos !== undefined && stats().trend_campeonatos !== null) {
            <div class="stat-trend" [class]="getTrendClass(stats().trend_campeonatos!)">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                @if (stats().trend_campeonatos! > 0) {
                  <polyline points="18 15 12 9 6 15"></polyline>
                } @else {
                  <polyline points="6 9 12 15 18 9"></polyline>
                }
              </svg>
              <span>{{ formatTrend(stats().trend_campeonatos!) }}</span>
            </div>
          }
        </div>
      </div>

      <!-- ORGANIZADORES REGISTRADOS -->
      <div class="stat-card">
        <div class="stat-icon green">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-label">Organizadores Registrados</div>
          <div class="stat-value">{{ stats().total_organizadores }}</div>
          @if (stats().trend_organizadores !== undefined && stats().trend_organizadores !== null) {
            <div class="stat-trend" [class]="getTrendClass(stats().trend_organizadores!)">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                @if (stats().trend_organizadores! > 0) {
                  <polyline points="18 15 12 9 6 15"></polyline>
                } @else {
                  <polyline points="6 9 12 15 18 9"></polyline>
                }
              </svg>
              <span>{{ formatTrend(stats().trend_organizadores!) }}</span>
            </div>
          }
        </div>
      </div>

      <!-- USUARIOS TOTALES -->
      <div class="stat-card">
        <div class="stat-icon purple">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-label">Usuarios Totales</div>
          <div class="stat-value">{{ stats().usuarios_totales }}</div>
          @if (stats().trend_usuarios !== undefined && stats().trend_usuarios !== null) {
            <div class="stat-trend" [class]="getTrendClass(stats().trend_usuarios!)">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                @if (stats().trend_usuarios! > 0) {
                  <polyline points="18 15 12 9 6 15"></polyline>
                } @else {
                  <polyline points="6 9 12 15 18 9"></polyline>
                }
              </svg>
              <span>{{ formatTrend(stats().trend_usuarios!) }}</span>
            </div>
          }
        </div>
      </div>

      <!-- SOLICITUDES PENDIENTES -->
      <div class="stat-card">
        <div class="stat-icon orange">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="9" y1="9" x2="15" y2="15"></line>
            <line x1="15" y1="9" x2="9" y2="15"></line>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-label">Solicitudes Pendientes</div>
          <div class="stat-value">{{ stats().solicitudes_pendientes }}</div>
          <div class="stat-trend trend-neutral">
            <span>Sin cambios</span>
          </div>
        </div>
      </div>
    </div>

    <!-- CHARTS & ACTIVITY -->
    <div class="content-grid">
      <!-- GROWTH CHART -->
      <div class="card chart-card">
        <div class="card-header">
          <h3>Crecimiento de Usuarios (Últimos 30 días)</h3>
        </div>
        <div class="card-body">
          @if (crecimientoUsuarios().length > 0) {
            <div class="chart-placeholder">
              <div class="simple-chart">
                <p class="chart-info">Total de usuarios: {{ stats().usuarios_totales }}</p>
                <p class="chart-info">Tendencia: {{ formatTrend(stats().trend_usuarios || 0) }}</p>
              </div>
            </div>
          } @else {
            <p class="no-data">No hay datos disponibles</p>
          }
        </div>
      </div>

      <!-- CHAMPIONSHIPS STATUS -->
      <div class="card donut-card">
        <div class="card-header">
          <h3>Estado de Campeonatos</h3>
        </div>
        <div class="card-body">
          <div class="donut-legend">
            <div class="legend-item">
              <span class="legend-dot" style="background: #4CAF50;"></span>
              <span class="legend-label">Activos</span>
              <span class="legend-value">{{ stats().campeonatos_activos }}</span>
            </div>
            <div class="legend-item">
              <span class="legend-dot" style="background: #9C27B0;"></span>
              <span class="legend-label">Finalizados</span>
              <span class="legend-value">{{ stats().campeonatos_finalizados || 0 }}</span>
            </div>
            <div class="legend-item">
              <span class="legend-dot" style="background: #FF9800;"></span>
              <span class="legend-label">Planificación</span>
              <span class="legend-value">{{ stats().campeonatos_planificacion || 0 }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- RECENT ACTIVITY & QUICK ACTIONS -->
    <div class="bottom-grid">
      <!-- RECENT ACTIVITY -->
      <div class="card activity-card">
        <div class="card-header">
          <h3>Actividad Reciente</h3>
        </div>
        <div class="card-body">
          @if (recentActivities().length > 0) {
            <div class="activity-table">
              <table>
                <thead>
                  <tr>
                    <th>ACCIÓN</th>
                    <th>USUARIO</th>
                    <th>FECHA</th>
                    <th>ESTADO</th>
                  </tr>
                </thead>
                <tbody>
                  @for (activity of recentActivities(); track activity.id) {
                    <tr>
                      <td>{{ activity.accion }}</td>
                      <td>{{ activity.usuario }}</td>
                      <td>{{ activity.fecha }}</td>
                      <td>
                        <span class="status-badge" [class]="getStatusClass(activity.estado)">
                          {{ activity.estado }}
                        </span>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <p class="no-data">No hay actividad reciente</p>
          }
        </div>
      </div>

      <!-- QUICK ACTIONS -->
      <div class="card actions-card">
        <div class="card-header">
          <h3>Acciones Rápidas</h3>
        </div>
        <div class="card-body">
          <button type="button" class="action-btn primary" (click)="openNuevoOrganizadorModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <line x1="19" y1="8" x2="19" y2="14"></line>
              <line x1="22" y1="11" x2="16" y2="11"></line>
            </svg>
            <span>Crear Organizador</span>
          </button>

          <a routerLink="/superadmin/organizadores" class="action-btn secondary">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <span>Ver Organizadores</span>
          </a>

          <a routerLink="/superadmin/analytics" class="action-btn secondary">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="20" x2="12" y2="10"></line>
              <line x1="18" y1="20" x2="18" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="16"></line>
            </svg>
            <span>Ver Analíticas</span>
          </a>
        </div>
      </div>
    </div>
  }
</div>

<!-- MODAL: CREAR ORGANIZADOR -->
@if (showNuevoOrganizadorModal()) {
  <div class="modal-overlay" (click)="closeNuevoOrganizadorModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <!-- MODAL HEADER -->
      <div class="modal-header">
        <div class="modal-title-group">
          <div class="modal-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <line x1="19" y1="8" x2="19" y2="14"></line>
              <line x1="22" y1="11" x2="16" y2="11"></line>
            </svg>
          </div>
          <div>
            <h2>Nuevo Organizador</h2>
            <p>Ingrese los detalles para crear una cuenta.</p>
          </div>
        </div>
        <button type="button" class="close-btn" (click)="closeNuevoOrganizadorModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <!-- SUCCESS MESSAGE -->
      @if (organizadorSuccess()) {
        <div class="alert alert-success">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          <span>{{ organizadorSuccess() }}</span>
        </div>
      }

      <!-- ERROR MESSAGE -->
      @if (organizadorError()) {
        <div class="alert alert-error">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <span>{{ organizadorError() }}</span>
        </div>
      }

      <!-- FORM -->
      <form [formGroup]="nuevoOrganizadorForm" (ngSubmit)="crearOrganizador()">
        <div class="modal-body">
          <!-- NOMBRE -->
          <div class="form-group">
            <label for="nombre">Nombre Completo del Organizador</label>
            <div class="input-wrapper">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="input-icon">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              <input 
                type="text" 
                id="nombre" 
                formControlName="nombre" 
                placeholder="Ingrese el nombre completo"
                [class.invalid]="nombreInvalid">
            </div>
            @if (nombreInvalid) {
              <span class="error-text">El nombre es requerido (mínimo 3 caracteres)</span>
            }
          </div>

          <!-- EMAIL -->
          <div class="form-group">
            <label for="email">Correo Electrónico (Solo Gmail)</label>
            <div class="input-wrapper">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="input-icon">
                <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                <path d="m2 7 10 7 10-7"></path>
              </svg>
              <input 
                type="email" 
                id="email" 
                formControlName="email" 
                placeholder="usuario@gmail.com"
                [class.invalid]="emailInvalid">
            </div>
            @if (emailInvalid) {
              <span class="error-text">Debe ser un correo de Gmail válido</span>
            }
          </div>

          <!-- CAMPEONATO -->
          <div class="form-group">
            <label for="nombre_campeonato">Nombre del Campeonato que Gestionará</label>
            <div class="input-wrapper">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="input-icon">
                <circle cx="12" cy="8" r="7"></circle>
                <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
              </svg>
              <input 
                type="text" 
                id="nombre_campeonato" 
                formControlName="nombre_campeonato" 
                placeholder="Ingrese el nombre del campeonato"
                [class.invalid]="campeonatoInvalid">
            </div>
            @if (campeonatoInvalid) {
              <span class="error-text">El nombre del campeonato es requerido</span>
            }
          </div>

          <!-- INFO BOX -->
          <div class="info-box">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M12 16v-4"></path>
              <path d="M12 8h.01"></path>
            </svg>
            <div>
              <strong>Envío automático de credenciales</strong>
              <p>Las credenciales temporales se generarán y mostrarán una sola vez. Guárdalas de forma segura.</p>
            </div>
          </div>
        </div>

        <!-- MODAL FOOTER -->
        <div class="modal-footer">
          <button type="button" class="btn-secondary" (click)="closeNuevoOrganizadorModal()" [disabled]="isCreatingOrganizador()">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="isCreatingOrganizador()">
            @if (isCreatingOrganizador()) {
              <span class="spinner-small"></span>
              Creando...
            } @else {
              Crear Organizador
            }
          </button>
        </div>
      </form>
    </div>
  </div>
}