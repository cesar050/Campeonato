<div class="organizadores-container">
  <!-- HEADER -->
  <div class="page-header">
    <div class="header-content">
      <h1>Organizadores</h1>
      <p class="subtitle">Gestiona todos los organizadores de campeonatos en la plataforma.</p>
    </div>
    <button type="button" class="btn-create" (click)="openModal()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      <span>Nuevo Organizador</span>
    </button>
  </div>

  <!-- FILTERS -->
  <div class="filters-bar">
    <div class="search-box">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="search-icon">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <input 
        type="text" 
        placeholder="Buscar por nombre o email..."
        (input)="onSearchChange($event)">
    </div>

    <div class="filter-group">
      <label>Estado:</label>
      <select (change)="onStatusChange($event)">
        <option value="Todos">Todos</option>
        <option value="Activo">Activo</option>
        <option value="Inactivo">Inactivo</option>
      </select>
    </div>

    <div class="filter-group">
      <label>Ordenar por:</label>
      <select>
        <option value="recent">Más recientes</option>
        <option value="name">Nombre A-Z</option>
        <option value="email">Email A-Z</option>
      </select>
    </div>
  </div>

  <!-- TABLE -->
  @if (isLoading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando organizadores...</p>
    </div>
  } @else if (filteredOrganizadores().length === 0) {
    <div class="empty-state">
      <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
      <h3>No hay organizadores</h3>
      <p>Crea el primer organizador para comenzar</p>
      <button type="button" class="btn-primary" (click)="openModal()">
        Crear Organizador
      </button>
    </div>
  } @else {
    <div class="table-container">
      <table class="organizadores-table">
        <thead>
          <tr>
            <th>ORGANIZADOR</th>
            <th>CAMPEONATO</th>
            <th>ESTADO</th>
            <th>EQUIPOS</th>
            <th>EMAIL VERIFICADO</th>
            <th>REGISTRADO</th>
            <th>ACCIONES</th>
          </tr>
        </thead>
        <tbody>
          @for (org of filteredOrganizadores(); track org.id_usuario) {
            <tr>
              <!-- ORGANIZADOR -->
              <td>
                <div class="user-cell">
                  <div class="user-avatar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                      <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                  </div>
                  <div class="user-info">
                    <div class="user-name">{{ org.nombre }}</div>
                    <div class="user-email">{{ org.email }}</div>
                  </div>
                </div>
              </td>

              <!-- CAMPEONATO -->
              <td>
                <span class="campeonato-name">{{ org.campeonato || 'Copa Primavera 2024' }}</span>
              </td>

              <!-- ESTADO -->
              <td>
                <span class="status-badge" [class]="getStatusBadgeClass(org.activo)">
                  <span class="status-dot"></span>
                  {{ org.activo ? 'Activo' : 'Inactivo' }}
                </span>
              </td>

              <!-- EQUIPOS -->
              <td>
                <span class="equipos-count">16</span>
              </td>

              <!-- EMAIL VERIFICADO -->
              <td>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" [class]="org.email_verified ? 'icon-verified' : 'icon-pending'">
                  @if (org.email_verified) {
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                  } @else {
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  }
                </svg>
              </td>

              <!-- REGISTRADO -->
              <td>
                <span class="date-text">{{ org.fecha_registro | date: 'dd MMM, yyyy' }}</span>
              </td>

              <!-- ACCIONES -->
              <td>
                <div class="action-buttons">
                  <button type="button" class="action-btn" title="Ver detalles" [routerLink]="['/superadmin/organizadores', org.id_usuario]">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                  </button>
                  <button type="button" class="action-btn" title="Enviar email">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                      <path d="m2 7 10 7 10-7"></path>
                    </svg>
                  </button>
                  <button type="button" class="action-btn danger" title="Desactivar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>

      <!-- PAGINATION -->
      <div class="table-footer">
        <span>Mostrando 1-10 de 1000</span>
        <div class="pagination">
          <button class="page-btn" disabled>Anterior</button>
          <button class="page-btn active">1</button>
          <button class="page-btn">2</button>
          <button class="page-btn">3</button>
          <button class="page-btn">Siguiente</button>
        </div>
      </div>
    </div>
  }
</div>

<!-- CREATE MODAL -->
@if (showModal()) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <!-- MODAL HEADER -->
      <div class="modal-header">
        <div class="modal-title-group">
          <div class="modal-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <line x1="19" y1="8" x2="19" y2="14"></line>
              <line x1="22" y1="11" x2="16" y2="11"></line>
            </svg>
          </div>
          <div>
            <h2>Nuevo Organizador</h2>
            <p>Ingrese los detalles para crear una cuenta.</p>
          </div>
        </div>
        <button type="button" class="close-btn" (click)="closeModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <!-- SUCCESS MESSAGE -->
      @if (successMessage()) {
        <div class="alert alert-success">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          <span>{{ successMessage() }}</span>
        </div>
      }

      <!-- ERROR MESSAGE -->
      @if (errorMessage()) {
        <div class="alert alert-error">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <span>{{ errorMessage() }}</span>
        </div>
      }

      <!-- MODAL BODY -->
      <form [formGroup]="createForm" (ngSubmit)="onSubmit()">
        <div class="modal-body">
          <!-- NOMBRE -->
          <div class="form-group">
            <label for="nombre">Nombre Completo del Organizador</label>
            <div class="input-wrapper">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="input-icon">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              <input 
                type="text" 
                id="nombre" 
                formControlName="nombre" 
                placeholder="Ingrese el nombre completo"
                [class.invalid]="nombreInvalid">
            </div>
            @if (nombreInvalid) {
              <span class="error-text">El nombre es requerido (mínimo 3 caracteres)</span>
            }
          </div>

          <!-- EMAIL -->
          <div class="form-group">
            <label for="email">Correo Electrónico (Solo Gmail)</label>
            <div class="input-wrapper">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="input-icon">
                <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                <path d="m2 7 10 7 10-7"></path>
              </svg>
              <input 
                type="email" 
                id="email" 
                formControlName="email" 
                placeholder="usuario@dominio.com"
                [class.invalid]="emailInvalid">
            </div>
            @if (createForm.get('email')?.hasError('notGmail') && createForm.get('email')?.touched) {
              <span class="error-text">Por favor, ingrese un correo de Gmail válido.</span>
            } @else if (emailInvalid) {
              <span class="error-text">El email es requerido</span>
            }
          </div>

          <!-- CAMPEONATO -->
          <div class="form-group">
            <label for="nombre_campeonato">Nombre del Campeonato que Gestionará</label>
            <div class="input-wrapper">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="input-icon">
                <circle cx="12" cy="8" r="7"></circle>
                <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
              </svg>
              <input 
                type="text" 
                id="nombre_campeonato" 
                formControlName="nombre_campeonato" 
                placeholder="Ingrese el nombre del campeonato"
                [class.invalid]="campeonatoInvalid">
            </div>
            @if (campeonatoInvalid) {
              <span class="error-text">El nombre del campeonato es requerido</span>
            }
          </div>

          <!-- INFO BOX -->
          <div class="info-box">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M12 16v-4"></path>
              <path d="M12 8h.01"></path>
            </svg>
            <div>
              <strong>Envío automático de credenciales</strong>
              <p>Una vez creada la cuenta, las credenciales de inicio de sesión se generarán y enviarán automáticamente al correo electrónico del organizador.</p>
            </div>
          </div>
        </div>

        <!-- MODAL FOOTER -->
        <div class="modal-footer">
          <button type="button" class="btn-secondary" (click)="closeModal()" [disabled]="isSubmitting()">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="isSubmitting()">
            @if (isSubmitting()) {
              <span class="spinner-small"></span>
              Creando...
            } @else {
              Crear Organizador
            }
          </button>
        </div>
      </form>
    </div>
  </div>
}